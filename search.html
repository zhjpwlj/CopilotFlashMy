<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="css/styles.css" />
  <title>ç¤¾åŒº | FlashMaster Pro</title>
</head>
<body>
  <header><h1>å…¬å¼€å¡ç»„æœç´¢</h1></header>

  <input id="query" placeholder="å…³é”®è¯ / æ ‡ç­¾" />
  <button id="searchBtn">ğŸ” æœç´¢</button>

  <ul id="results"></ul>

  <script type="module">
    import { db }                    from './js/firebase.js';
    import { collection, query,
             where, getDocs }
      from 'https://cdn.jsdelivr.net/npm/firebase@10.12.2/firestore/lite/index.esm.js';

    const qInput = document.getElementById('query');
    const results = document.getElementById('results');

    document.getElementById('searchBtn').onclick = async () => {
      const kw = qInput.value.trim().toLowerCase();
      if (!kw) return;
      results.textContent = 'æœç´¢ä¸­â€¦';

      try {
        const q   = query(collection(db, 'publicSets'),
                          where('keywords', 'array-contains', kw));
        const snap = await getDocs(q);
        results.innerHTML = '';
        if (snap.empty) return results.textContent = 'æœªæ‰¾åˆ°ç»“æœã€‚';

        snap.forEach(doc => {
          const li = document.createElement('li');
          li.textContent = doc.data().title;
          li.onclick = () => location.href =
            `study.html?set=${doc.id}`;
          results.appendChild(li);
        });
      } catch(e) {
        results.textContent = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·ç¨åé‡è¯•ã€‚';
      }
    };
  </script>
</body>
</html>
